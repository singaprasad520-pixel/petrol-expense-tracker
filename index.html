<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Petrol Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root { --yellow:#ffcc00; --bg:#f9f9f9; }
body {margin:0;font-family:Arial, sans-serif;background:var(--bg);}
h2,h3 {margin:0 0 1rem 0;}
.page {padding:1rem;}
button {cursor:pointer;}

/* Sidebar (desktop) */
.sidebar {
  position:fixed;top:0;left:0;width:200px;height:100%;
  background:var(--yellow);padding:1rem;display:flex;flex-direction:column;
}
.sidebar h2 {font-size:1.2rem;margin-bottom:1rem;}
.sidebar button {background:none;border:none;padding:0.5rem;text-align:left;font-weight:bold;}

/* Content */
.content {margin-left:200px;padding:1rem;}

/* Bottom Nav (mobile) */
.bottom-nav {
  display:none;position:fixed;bottom:0;left:0;width:100%;
  background:#fff;border-top:1px solid #ddd;
  display:flex;justify-content:space-around;padding:0.5rem 0;
}
.bottom-nav button {background:none;border:none;font-weight:bold;}

/* Add Form */
.add-form {
  display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-top:1rem;
}
.add-form label {font-weight:bold;margin-bottom:0.2rem;display:block;}
.add-form input {
  width:100%;padding:0.6rem;border:1px solid #ccc;border-radius:6px;font-size:1rem;
}
.add-form button {
  grid-column: span 2;padding:0.8rem;background:var(--yellow);
  border:none;border-radius:6px;font-weight:bold;
}
.edit-badge {
  background:#fff9c4;color:#444;padding:0.4rem 0.8rem;border-radius:6px;
  margin-bottom:1rem;font-size:0.9rem;font-weight:bold;display:inline-block;
}

/* History Table */
.table-container {margin-top:1rem;overflow-x:auto;}
table {width:100%;border-collapse:collapse;min-width:500px;}
th,td {border:1px solid #ddd;padding:0.6rem;text-align:center;}
th {background:var(--yellow);}
.editing {background:#fff9c4 !important;}

/* Mobile History Cards */
@media(max-width:768px){
  .sidebar {display:none;}
  .content {margin-left:0;padding-bottom:4rem;}
  .add-form {grid-template-columns:1fr;}
  .add-form button {grid-column:span 1;}
  th,td {padding:0.4rem;font-size:0.85rem;}
  .table-container {display:none;}
  .history-cards {display:flex;flex-direction:column;gap:1rem;margin-top:1rem;}
  .history-card {
    background:#fff;border-radius:8px;padding:1rem;
    box-shadow:0 2px 5px rgba(0,0,0,0.05);
  }
  .history-card p {margin:0.2rem 0;font-size:0.9rem;}
  .bottom-nav {display:flex;}
}
@media(min-width:769px){ .history-cards {display:none;} }

/* Reports */
.reports-grid {
  display:grid;grid-template-columns:repeat(2,1fr);
  gap:1rem;margin-top:1rem;
}
.report-card {
  background:#fff;padding:1rem;border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,0.05);
}
@media(max-width:768px){ .reports-grid{grid-template-columns:1fr;} }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h2>Tracker</h2>
  <button onclick="showPage('home')">üè† Home</button>
  <button onclick="showPage('add')">‚ûï Add Entry</button>
  <button onclick="showPage('history')">üìë History</button>
  <button onclick="showPage('reports')">üìä Reports</button>
</div>

<!-- Content -->
<div class="content">

  <!-- Home -->
  <div id="home" class="page">
    <h3>Welcome to Petrol Expense Tracker</h3>
    <p>Use the menu to add new entries, view history, and check reports.</p>
  </div>

  <!-- Add Entry -->
  <div id="add" class="page" style="display:none;">
    <h3 id="addEntryTitle">Add New Entry</h3>
    <div id="editBadge" style="display:none;" class="edit-badge">‚úèÔ∏è Editing existing entry</div>
    <form id="entryForm" class="add-form" onsubmit="event.preventDefault();addEntry();">
      <div><label>Date</label><input type="date" id="date" required></div>
      <div><label>Amount (‚Çπ)</label><input type="number" id="amount" step="0.01" required></div>
      <div><label>Litres</label><input type="number" id="litres" step="0.01" required></div>
      <div><label>Additives (‚Çπ)</label><input type="number" id="additives" step="0.01" value="0"></div>
      <div><label>Start KM</label><input type="number" id="startKm"></div>
      <div><label>End KM</label><input type="number" id="endKm"></div>
      <button type="submit">Save Entry</button>
      <button type="button" id="cancelEditBtn" style="display:none;background:#ccc;">Cancel Edit</button>
    </form>
  </div>

  <!-- History -->
  <div id="history" class="page" style="display:none;">
    <h3>History</h3>
    <div class="table-container">
      <table>
        <thead>
          <tr><th>Date</th><th>Amount</th><th>Litres</th><th>Additives</th><th>Start KM</th><th>End KM</th><th>Actions</th></tr>
        </thead>
        <tbody id="historyTable"></tbody>
      </table>
    </div>
    <div class="history-cards" id="historyCards"></div>
  </div>

  <!-- Reports -->
  <div id="reports" class="page" style="display:none;">
    <h3>Reports</h3>
    <div class="reports-grid">
      <div class="report-card"><h4>Trend (Amount & Litres)</h4><canvas id="trendChart"></canvas></div>
      <div class="report-card"><h4>Mileage Trend</h4><canvas id="mileageChart"></canvas></div>
      <div class="report-card"><h4>Expense Breakdown</h4><canvas id="breakdownChart"></canvas></div>
      <div class="report-card"><h4>Summary</h4><ul id="reportSummary"></ul></div>
    </div>
  </div>
</div>

<!-- Bottom Nav -->
<div class="bottom-nav">
  <button onclick="showPage('home')">üè†</button>
  <button onclick="showPage('add')">‚ûï</button>
  <button onclick="showPage('history')">üìë</button>
  <button onclick="showPage('reports')">üìä</button>
</div>

<script>
let entries = JSON.parse(localStorage.getItem("entries")||"[]");
let editIndex = null;

function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";
  if(id==="history") renderHistory();
  if(id==="reports") renderReports();
}

function addEntry(){
  let e = {
    date:document.getElementById("date").value,
    amount:+document.getElementById("amount").value,
    additives:+document.getElementById("additives").value,
    litres:+document.getElementById("litres").value,
    startKm:+document.getElementById("startKm").value || null,
    endKm:+document.getElementById("endKm").value || null
  };
  if(editIndex!==null){
    entries[editIndex]=e; editIndex=null; alert("Entry Updated!");
  } else { entries.push(e); alert("Entry Added!"); }
  localStorage.setItem("entries",JSON.stringify(entries));
  document.getElementById("entryForm").reset();
  document.getElementById("addEntryTitle").innerText="Add New Entry";
  document.getElementById("cancelEditBtn").style.display="none";
  document.getElementById("editBadge").style.display="none";
  renderHistory(); showPage("history");
}

function editEntry(i){
  let e=entries[i];
  document.getElementById("date").value=e.date;
  document.getElementById("amount").value=e.amount;
  document.getElementById("additives").value=e.additives;
  document.getElementById("litres").value=e.litres;
  document.getElementById("startKm").value=e.startKm||"";
  document.getElementById("endKm").value=e.endKm||"";
  editIndex=i;
  document.getElementById("addEntryTitle").innerText="Edit Entry";
  document.getElementById("cancelEditBtn").style.display="inline-block";
  document.getElementById("editBadge").style.display="inline-block";
  renderHistory();
  showPage("add");
}

document.getElementById("cancelEditBtn").addEventListener("click",()=>{
  editIndex=null;
  document.getElementById("entryForm").reset();
  document.getElementById("addEntryTitle").innerText="Add New Entry";
  document.getElementById("cancelEditBtn").style.display="none";
  document.getElementById("editBadge").style.display="none";
  showPage("history");
});

function deleteEntry(i){
  if(confirm("Are you sure you want to delete this entry?")){
    entries.splice(i,1);
    localStorage.setItem("entries",JSON.stringify(entries));
    renderHistory();
    alert("Entry Deleted!");
  }
}

function renderHistory(){
  let tbody=document.getElementById("historyTable");
  let cards=document.getElementById("historyCards");
  tbody.innerHTML=""; cards.innerHTML="";
  entries.forEach((e,i)=>{
    let tr=document.createElement("tr");
    if(editIndex===i) tr.classList.add("editing");
    tr.innerHTML=`<td>${e.date}</td><td>‚Çπ${e.amount}</td><td>${e.litres} L</td>
      <td>‚Çπ${e.additives}</td><td>${e.startKm||"-"}</td><td>${e.endKm||"-"}</td>
      <td><button onclick="editEntry(${i})">Edit</button>
      <button onclick="deleteEntry(${i})">Delete</button></td>`;
    tbody.appendChild(tr);

    let card=document.createElement("div");
    card.className="history-card";
    if(editIndex===i) card.classList.add("editing");
    card.innerHTML=`<p><b>Date:</b> ${e.date}</p><p><b>Amount:</b> ‚Çπ${e.amount}</p>
      <p><b>Litres:</b> ${e.litres} L</p><p><b>Additives:</b> ‚Çπ${e.additives}</p>
      <p><b>Start KM:</b> ${e.startKm||"-"}</p><p><b>End KM:</b> ${e.endKm||"-"}</p>
      <button onclick="editEntry(${i})">Edit</button>
      <button onclick="deleteEntry(${i})">Delete</button>`;
    cards.appendChild(card);
  });
}

function renderReports(){
  let ctx1=document.getElementById("trendChart"), ctx2=document.getElementById("mileageChart"), ctx3=document.getElementById("breakdownChart");
  if(!entries.length) return;
  let labels=entries.map(e=>e.date);
  let amounts=entries.map(e=>e.amount);
  let litres=entries.map(e=>e.litres);
  let mileage=entries.map(e=>(e.endKm&&e.startKm)?((e.endKm-e.startKm)/e.litres).toFixed(1):null);

  new Chart(ctx1,{type:'line',data:{labels,datasets:[
    {label:"Amount",data:amounts,borderColor:"red"},
    {label:"Litres",data:litres,borderColor:"blue"}
  ]}});
  new Chart(ctx2,{type:'line',data:{labels,datasets:[
    {label:"Mileage (KM/L)",data:mileage,borderColor:"green"}
  ]}});
  new Chart(ctx3,{type:'pie',data:{labels:["Fuel","Additives"],datasets:[{
    data:[amounts.reduce((a,b)=>a+b,0), entries.reduce((a,b)=>a+b.additives,0)],
    backgroundColor:["#ffcc00","#999"]
  }]}});

  let summary=document.getElementById("reportSummary");
  summary.innerHTML="";
  summary.innerHTML+=`<li>Total Spent: ‚Çπ${amounts.reduce((a,b)=>a+b,0)}</li>`;
  summary.innerHTML+=`<li>Total Litres: ${litres.reduce((a,b)=>a+b,0)} L</li>`;
  let avgRate=(amounts.reduce((a,b)=>a+b,0)/litres.reduce((a,b)=>a+b,1)).toFixed(2);
  summary.innerHTML+=`<li>Avg Rate: ‚Çπ${avgRate}/L</li>`;
}
</script>
</body>
</html>
